<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç»ˆæå†³ç­–åŠ©æ‰‹ Web</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="text-center mb-4">ğŸ¯ ç»ˆæå†³ç­–åŠ©æ‰‹ Web ç‰ˆ</h1>

    <div class="mb-3">
      <textarea id="options" class="form-control" rows="6" placeholder="æ¯è¡Œä¸€ä¸ªé€‰é¡¹ï¼Œæ”¯æŒ # æ³¨é‡Š"></textarea>
    </div>

    <div class="mb-3 d-flex align-items-center gap-2">
      <input type="file" id="fileInput" accept=".txt" class="form-control" style="max-width: 300px;">
      <button class="btn btn-outline-primary" onclick="uploadTxt()">å¯¼å…¥ .txt æ–‡ä»¶</button>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-3">
      <button class="btn btn-primary me-md-2" onclick="doRandom()">å¼€å§‹éšæœº</button>
      <button class="btn btn-secondary me-md-2" onclick="showCustom()">è‡ªå®šä¹‰éšæœº</button>
      <button class="btn btn-outline-success" onclick="clearHistory()">æ¸…é™¤å†å²</button>
      <a href="/export" class="btn btn-outline-dark" target="_blank">å¯¼å‡ºè®°å½•</a>
    </div>

    <div class="alert alert-info text-center" id="result">è¯·è¾“å…¥é€‰é¡¹åç‚¹å‡»æŒ‰é’®</div>

    <h5>ğŸ“œ å†å²è®°å½•ï¼š</h5>
    <div class="border p-3 bg-white" style="max-height: 300px; overflow-y: auto;">
      {% for line in history[::-1] %}
        <div class="border-bottom py-1 small">{{ line }}</div>
      {% else %}
        <div class="text-muted">æš‚æ— è®°å½•</div>
      {% endfor %}
    </div>
  </div>

  <!-- è‡ªå®šä¹‰æ¬¡æ•°å¼¹çª— -->
  <div class="modal" tabindex="-1" id="customModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">è‡ªå®šä¹‰éšæœºæ¬¡æ•°</h5>
          <button type="button" class="btn-close" onclick="hideCustom()"></button>
        </div>
        <div class="modal-body">
          <input id="customTimes" type="number" class="form-control" placeholder="è¯·è¾“å…¥æ¬¡æ•°" min="1">
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="doCustom()">ç¡®å®š</button>
          <button class="btn btn-secondary" onclick="hideCustom()">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const modal = new bootstrap.Modal(document.getElementById('customModal'));

    function showCustom() { modal.show(); }
    function hideCustom() { modal.hide(); }

    async function doRandom() {
      const options = document.getElementById('options').value;
      const res = await fetch('/random', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'options=' + encodeURIComponent(options)
      });
      const json = await res.json();
      document.getElementById('result').textContent = json.result || json.error;
      if (json.error) alert(json.error);
    }

    async function doCustom() {
      const options = document.getElementById('options').value;
      const times = document.getElementById('customTimes').value;
      hideCustom();
      const res = await fetch('/custom', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'options=' + encodeURIComponent(options) + '&times=' + encodeURIComponent(times)
      });
      const json = await res.json();
      document.getElementById('result').textContent = json.result || json.error;
      if (json.error) alert(json.error);
    }

    async function clearHistory() {
      if (!confirm("ç¡®å®šæ¸…é™¤æ‰€æœ‰å†å²è®°å½•ï¼Ÿ")) return;
      const res = await fetch('/clear', { method: 'POST' });
      if (res.ok) location.reload();
    }

    async function uploadTxt() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) return alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ª .txt æ–‡ä»¶");
      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      const res = await fetch('/upload', { method: 'POST', body: formData });
      const json = await res.json();
      if (json.content) {
        document.getElementById('options').value = json.content;
      } else {
        alert(json.error || 'ä¸Šä¼ å¤±è´¥');
      }
    }
  </script>
</body>
</html>
